<script>
let socket = new WebSocket("wss://telugu-random-chat.onrender.com");

// When message comes from server
socket.onmessage = function(event) {
  let data = JSON.parse(event.data);
  let box = document.getElementById("chat-box");

  if (data.system) {
    box.innerHTML += "<div><i>" + data.system + "</i></div>";
  }
  if (data.message) {
    box.innerHTML += "<div><b>Stranger:</b> " + data.message + "</div>";
  }

  box.scrollTop = box.scrollHeight;
};

// Send Button
document.getElementById('send-btn').onclick = function() {
  let msg = document.getElementById('input').value;

  if (msg.trim() !== "") {
    socket.send(msg);
    let box = document.getElementById('chat-box');
    box.innerHTML += "<div><b>You:</b> " + msg + "</div>";
    document.getElementById('input').value = "";
    box.scrollTop = box.scrollHeight;
  }
};

// Next Button
document.getElementById('next-btn').onclick = function() {
  socket.close();
  document.getElementById("chat-box").innerHTML = "<i>Connecting to a new partner...</i>";

  socket = new WebSocket("wss://telugu-random-chat.onrender.com");

  socket.onmessage = function(event) {
    let data = JSON.parse(event.data);
    let box = document.getElementById("chat-box");

    if (data.system) {
      box.innerHTML += "<div><i>" + data.system + "</i></div>";
    }
    if (data.message) {
      box.innerHTML += "<div><b>Stranger:</b> " + data.message + "</div>";
    }

    box.scrollTop = box.scrollHeight;
  };
};
</script>
